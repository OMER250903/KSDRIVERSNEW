
                                                                                          <!DOCTYPE html>
                                                                                          <html lang="he" dir="rtl">
                                                                                          <head>
                                                                                            <meta charset="UTF-8">
                                                                                            <title>◊ì◊ï"◊ó ◊û◊¢◊ë◊® ◊ë◊ß◊®◊î</title>
                                                                                            <link rel="stylesheet" href="/style.css">
                                                                                            <style>
                                                                                              body {
                                                                                                font-family: 'Assistant', sans-serif;
                                                                                                background-color: #f3f6fa;
                                                                                                margin: 0;
                                                                                                padding: 0;
                                                                                              }
                                                                                              header.main-header {
                                                                                                background-color: #004080;
                                                                                                color: white;
                                                                                                padding: 20px 40px;
                                                                                                display: flex;
                                                                                                align-items: center;
                                                                                                justify-content: center;
                                                                                                position: relative;
                                                                                              }
                                                                                              .page-title {
                                                                                            font-size: 35px;
                                                                                            color: white;
                                                                                            margin: 0 auto;
                                                                                            font-weight: bold;
                                                                                          }

                                                                                              }
                                                                                              .logo {
                                                                                            height: 80px;
                                                                                            position: absolute;
                                                                                            right: 20px;
                                                                                          }

                                                                                             .container {
                                                                                            max-width: 1400px;
                                                                                            margin: 40px auto;
                                                                                            padding: 0 30px;
                                                                                          }

                                                                                              .search-bar {
                                                                                                width: 100%;
                                                                                                padding: 12px 16px;
                                                                                                font-size: 16px;
                                                                                                border-radius: 8px;
                                                                                                border: 1px solid #ccc;
                                                                                                margin: 20px 0;
                                                                                              }
                                                                                              .excel-button {
                                                                                                background-color: #1d6f42;
                                                                                                color: white;
                                                                                                padding: 10px 20px;
                                                                                                font-weight: bold;
                                                                                                border: none;
                                                                                                border-radius: 8px;
                                                                                                cursor: pointer;
                                                                                                text-decoration: none;
                                                                                                display: inline-block;
                                                                                              }
                                                                                              .excel-button:hover {
                                                                                                background-color: #145c35;
                                                                                              }
                                                                                              .excel-button img {
                                                                                                vertical-align: middle;
                                                                                                margin-left: 8px;
                                                                                                width: 20px;
                                                                                              }
                                                                                              table.drivers-table {
                                                                                                width: 100%;
                                                                                                border-collapse: collapse;
                                                                                                background: white;
                                                                                                border-radius: 8px;
                                                                                                overflow: hidden;
                                                                                                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                                                                                              }
                                                                                            table.drivers-table th {
                                                                                            background-color: #004080;
                                                                                            color: white;
                                                                                            font-weight: bold;
                                                                                            font-size: 16px;
                                                                                            cursor: pointer;
                                                                                            padding: 16px;
                                                                                          }

                                                                                            table.drivers-table td {
                                                                                            color: #222;
                                                                                            font-size: 17px;
                                                                                            padding: 20px 18px;
                                                                                            border-bottom: 1px solid #ddd;
                                                                                            text-align: center;
                                                                                          }

                                                                                              table.drivers-table tbody tr:hover {
                                                                                                background-color: #f0f4ff;
                                                                                              }
                                                                                              .statistics-button {
                                                                                                display: inline-block;
                                                                                                margin-top: 30px;
                                                                                                font-weight: bold;
                                                                                                background-color: #004080;
                                                                                                color: white;
                                                                                                padding: 10px 20px;
                                                                                                border-radius: 8px;
                                                                                                text-decoration: none;
                                                                                              }

                                                                                              .date-form {
                                                                                            background-color: #ffffff;
                                                                                            border: 1px solid #cfdfff;
                                                                                            padding: 20px;
                                                                                            border-radius: 12px;
                                                                                            max-width: 420px;
                                                                                            margin: 20px auto;
                                                                                            font-family: 'Assistant', sans-serif;
                                                                                            direction: rtl;
                                                                                            text-align: right;
                                                                                            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                                                                                          }

                                                                                          .date-form label {
                                                                                            display: block;
                                                                                            font-weight: bold;
                                                                                            margin-bottom: 10px;
                                                                                            font-size: 16px;
                                                                                            color: #004080;
                                                                                          }

                                                                                          .date-controls {
                                                                                            display: flex;
                                                                                            gap: 10px;
                                                                                            align-items: center;
                                                                                          }

                                                                                          .date-controls input[type="date"] {
                                                                                            padding: 8px 10px;
                                                                                            font-size: 15px;
                                                                                            border-radius: 8px;
                                                                                            border: 1px solid #999;
                                                                                            flex-grow: 1;
                                                                                          }

                                                                                          .date-controls button {
                                                                                            background-color: #004080;
                                                                                            color: white;
                                                                                            border: none;
                                                                                            padding: 8px 16px;
                                                                                            border-radius: 8px;
                                                                                            font-weight: bold;
                                                                                            cursor: pointer;
                                                                                            transition: background-color 0.3s ease;
                                                                                          }

                                                                                          .date-controls button:hover {
                                                                                            background-color: #002c5f;
                                                                                          }

                                                  .status-container {
                                                    display: flex;
                                                    flex-wrap: wrap;
                                                    gap: 30px;
                                                    margin: 30px 0;
                                                    justify-content: center;
                                                  }

                                                  .status-box {
                                                    background: linear-gradient(to bottom, #eaf3ff, #ffffff);
                                                    border: 1px solid #a0c4ff;
                                                    border-radius: 16px;
                                                    padding: 24px;
                                                    min-width: 300px;
                                                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
                                                    direction: rtl;
                                                    text-align: right;
                                                    transition: 0.3s ease;
                                                  }

                                                  .status-box:hover {
                                                    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
                                                  }

                                                  .status-title {
                                                    font-weight: bold;
                                                    font-size: 22px;
                                                    color: #003366;
                                                    margin-bottom: 18px;
                                                    border-bottom: 2px solid #004080;
                                                    padding-bottom: 6px;
                                                  }

                                                  .status-item {
                                                    font-size: 17px;
                                                    margin-bottom: 8px;
                                                    color: #333;
                                                    line-height: 1.7;
                                                  }

                                                  .status-sub {
                                                    font-size: 15px;
                                                    color: #d32f2f;
                                                    margin-top: 16px;
                                                    font-weight: bold;
                                                  }

                                                  .status-summary {
                                                    font-size: 17px;
                                                    font-weight: bold;
                                                    margin-top: 20px;
                                                    color: #004080;
                                                    border-top: 1px dashed #999;
                                                    padding-top: 10px;
                                                  }
                                                  .status-container {
                                                    display: flex;
                                                    flex-wrap: wrap;
                                                    gap: 30px;
                                                    justify-content: center;
                                                    margin-bottom: 30px;
                                                  }

                                                  .status-box {
                                                    background-color: #f0f4ff;
                                                    border: 1px solid #c2d3ff;
                                                    border-radius: 12px;
                                                    padding: 20px;
                                                    width: 320px;
                                                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
                                                    direction: rtl;
                                                    font-family: 'Assistant', sans-serif;
                                                  }

                                                  .status-title {
                                                    font-size: 20px;
                                                    font-weight: bold;
                                                    color: #003366;
                                                    border-bottom: 1px solid #a0a0a0;
                                                    margin-bottom: 12px;
                                                    padding-bottom: 6px;
                                                    text-align: right;
                                                  }

                                                  .status-line {
                                                    font-size: 16px;
                                                    margin-bottom: 6px;
                                                    color: #222;
                                                    text-align: right;
                                                  }

                                                  .status-refused-title {
                                                    font-weight: bold;
                                                    color: #b00020;
                                                    margin-top: 14px;
                                                    text-align: right;
                                                  }

                                                  .status-refused-line {
                                                    font-size: 15px;
                                                    color: #b00020;
                                                    margin-bottom: 4px;
                                                    text-align: right;
                                                  }

                                                  .status-summary {
                                                    font-size: 16px;
                                                    font-weight: bold;
                                                    color: #004080;
                                                    border-top: 1px dashed #999;
                                                    margin-top: 16px;
                                                    padding-top: 10px;
                                                    text-align: right;
                                                  }
                                                  .summary-table {
                                                    background: white;
                                                    border-radius: 14px;
                                                    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
                                                    padding: 20px;
                                                    width: fit-content;
                                                    margin: 0 auto 30px auto;
                                                    direction: rtl;
                                                    text-align: right;
                                                    font-family: 'Assistant', sans-serif;
                                                  }

                                                  .table-title {
                                                    font-size: 18px;
                                                    font-weight: bold;
                                                    color: #003366;
                                                    margin-bottom: 14px;
                                                    border-bottom: 2px solid #003366;
                                                    padding-bottom: 6px;
                                                  }

                                                  .org-table {
                                                    width: 100%;
                                                    border-collapse: collapse;
                                                  }

                                                  .org-table th {
                                                    background-color: #004080;
                                                    color: white;
                                                    font-weight: bold;
                                                    padding: 10px;
                                                  }

                                                  .org-table td {
                                                    padding: 10px;
                                                    font-size: 16px;
                                                    border-bottom: 1px solid #ddd;
                                                  }

                                                  .org-table tfoot td {
                                                    background-color: #f0f0f0;
                                                    font-weight: bold;
                                                  }






                                                  .status-section {
                                                    display: flex;
                                                    justify-content: center;
                                                    gap: 30px;
                                                    margin-bottom: 30px;
                                                    flex-wrap: wrap;
                                                  }

                                                  .status-box {
                                                    background-color: #fff;
                                                    border-radius: 14px;
                                                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                                                    padding: 20px 30px;
                                                    min-width: 280px;
                                                    max-width: 360px;
                                                    text-align: right;
                                                    font-family: 'Assistant', sans-serif;
                                                    position: relative;
                                                  }

                                                  .status-box h3 {
                                                    font-size: 18px;
                                                    font-weight: bold;
                                                    color: #003366;
                                                    border-bottom: 2px solid #003366;
                                                    padding-bottom: 8px;
                                                    margin-bottom: 15px;
                                                  }

                                                  .status-box p {
                                                    font-size: 16px;
                                                    margin: 4px 0;
                                                  }

                                                  .status-box .footer {
                                                    border-top: 1px solid #ccc;
                                                    padding-top: 8px;
                                                    margin-top: 12px;
                                                    font-weight: bold;
                                                    color: #444;
                                                  }
                                                  </style>
                                                                                          </head>
                                                                                          <body>

                                                                                            <header class="main-header">
                                                                                              <h1 class="page-title">◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊ï◊™ ◊ï◊†◊™◊ï◊†◊ô◊ù</h1>
                                                                                              <img src="https://cdn.glitch.global/64a24585-7ccf-4cfb-bfc3-67e1b6c37fe4/logo.png?v=1745867431324" alt="◊ú◊ï◊í◊ï" class="logo">
                                                                                            </header>
                                                                                          <form onsubmit="goToDate(event)" class="date-form">
                                                                                            <label for="datePicker">◊ë◊ó◊® ◊™◊ê◊®◊ô◊ö ◊ú◊î◊¶◊í◊™ ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊î:</label>
                                                                                          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
                                                                                            <div class="date-controls">
                                                                                              <input type="date" id="datePicker" name="date" value="<%= today || '' %>" required>
                                                                                              <button type="submit">◊ò◊¢◊ü</button>
                                                                                            </div>
                                                                                          </form>


                                                                                            <div class="container">
                                                                                          <form id="searchForm" style="max-width: 1400px; margin: 20px auto; padding: 0 30px;">
                                                                                            <div style="position: relative; display: flex; align-items: center;">
                                                                                              <!-- ◊©◊ì◊î ◊ó◊ô◊§◊ï◊© ◊û◊¢◊ï◊¶◊ë -->
                                                                                              <input
                                                                                                type="text"
                                                                                                id="filterInput"
                                                                                                name="q"
                                                                                                value="<%= typeof query !== 'undefined' ? query : '' %>"
                                                                                                class="search-bar"
                                                                                                placeholder="üîç ◊ó◊§◊© ◊ú◊§◊ô ◊ò◊ß◊°◊ò ◊ó◊ï◊§◊©◊ô ◊ë◊õ◊ú ◊î◊ò◊ë◊ú◊î..."
                                                                                                style="width: 100%; padding: 14px 50px 14px 20px; font-size: 16px; border-radius: 40px; border: 1px solid #ccc; background-color: white; box-shadow: 0 2px 6px rgba(0,0,0,0.08);"
                                                                                              >

                                                                                              <!-- ◊õ◊§◊™◊ï◊® ◊ú◊ï◊ó ◊©◊†◊î ◊û◊¢◊ï◊¶◊ë ◊ë◊§◊†◊ô◊ù -->
                                                                                              <button
                                                                                                type="button"
                                                                                                id="toggleHistory"
                                                                                                title="◊ó◊ô◊§◊ï◊© ◊î◊ô◊°◊ò◊ï◊®◊ô"
                                                                                            onclick="toggleHistoryMode()"
                                                                                                style="position: absolute; left: 12px; background: none; border: none; color: #004080; font-size: 20px; cursor: pointer;"
                                                                                              >
                                                                                                <i class="fa-solid fa-calendar-days"></i>
                                                                                              </button>
                                                                                            </div>
                                                                                          </form>


                                                                                          <%
                                                                                            const orgStats = {};
                                                                                          const routeStats = {};
                                                                                          passedDrivers.forEach(driver => {
                                                                                            const isRefused = refusedCoordinations.some(coord =>
                                                                                              coord.coordinationNumber === driver.coordinationNumber &&
                                                                                              coord.donorOrg === driver.donorOrg
                                                                                            );
                                                                                            if (isRefused) return; // ◊ê◊ú ◊™◊õ◊ú◊ï◊ú ◊ë◊§◊ô◊ú◊ï◊ó

                                                                                            const org = driver.donorOrg || '◊ú◊ú◊ê ◊ê◊®◊í◊ï◊ü';
                                                                                            orgStats[org] = (orgStats[org] || 0) + 1;

                                                                                            const route = driver.route || '◊ú◊ú◊ê ◊†◊™◊ô◊ë';
                                                                                            routeStats[route] = (routeStats[route] || 0) + 1;
                                                                                          });


                                                                                            const refusedCount = (refusedCoordinations && refusedCoordinations.length) ? refusedCoordinations.length : 0;
                                                                                            const totalDrivers = passedDrivers.length - refusedCount;
                                                                                          %>



                                                  <% if (routeSummary && Object.keys(routeSummary).length > 0) { %>
                                                    <div class="status-section">
                                                      <% ['◊ô◊©◊®◊ê◊ú', '◊û◊¶◊®◊ô◊ù'].forEach(region => { %>
                                                        <% if (routeSummary[region]) { %>
                                                          <div class="status-box">
                                                            <h3>◊°◊ò◊ò◊ï◊° - <%= region %><% if (region === '◊û◊¶◊®◊ô◊ù') { %> üá™üá¨ <% } %></h3>
                                                            <% Object.entries(routeSummary[region]).forEach(([donor, count]) => { %>
                                                              <p><%= donor %> - <%= count %> ◊û◊©◊ê◊ô◊ï◊™</p>
                                                            <% }) %>
                                                            <p class="footer">◊°◊î"◊õ ◊†◊õ◊†◊°◊ï <%= Object.values(routeSummary[region]).reduce((a,b)=>a+b,0) %> ◊û◊©◊ê◊ô◊ï◊™ <%= region === '◊û◊¶◊®◊ô◊ù' ? '◊û◊û◊¶◊®◊ô◊ù' : '◊û◊ô◊©◊®◊ê◊ú' %></p>
                                                          </div>
                                                        <% } %>
                                                      <% }) %>
                                                    </div>
                                                  <% } %>
                                                      </h3>
                                                            <% Object.entries(routeSummary[region].routes).forEach(([routeName, count]) => { %>
                                                              <p class="status-line">üì¶ <%= routeName %> ‚Äì <%= count.total %> ◊û◊©◊ê◊ô◊ï◊™</p>
                                                              <% Object.entries(count.byOrg).forEach(([org, orgCount]) => { %>
                                                                <p class="status-line">‚Ä¢ <%= org %> ‚Äì <%= orgCount %> ◊û◊©◊ê◊ô◊ï◊™</p>
                                                              <% }) %>
                                                            <% }) %>
                                                            <% if (routeSummary[region].refused && routeSummary[region].refused.length > 0) { %>
                                                              <p class="status-refused-title">◊û◊©◊ê◊ô◊ï◊™ ◊û◊°◊ï◊®◊ë◊ï◊™ ◊û<%= region %>:</p>
                                                              <% routeSummary[region].refused.forEach((item, index) => { %>
                                                                <p class="status-refused-line"><%= index + 1 %>. ◊™◊ô◊ê◊ï◊ù <%= item.coordinationNumber %> ‚Äì ◊ê◊®◊í◊ï◊ü <%= item.donorOrg %> ‚Äì <%= item.reason %></p>
                                                              <% }) %>
                                                            <% } %>
                                                            <p class="status-summary">◊°◊î\"◊õ ◊†◊õ◊†◊°◊ï <%= routeSummary[region].totalPassed %> ◊û◊©◊ê◊ô◊ï◊™ ◊û<%= region %></p>
                                                          </div>
                                                        <% } %>
                                                      <% }) %>
                                                    </div>
                                                  <% } %>

                                                  <div class="summary-table">
                                                    <div class="table-title">
                                                      <i class="fa-solid fa-chart-column"></i> ◊§◊ô◊ú◊ï◊ó ◊ú◊§◊ô ◊ê◊®◊í◊ï◊ü ◊™◊ï◊®◊ù
                                                    </div>
                                                    <table class="org-table">
                                                      <thead>
                                                        <tr>
                                                          <th>◊ê◊®◊í◊ï◊ü</th>
                                                          <th>◊õ◊û◊ï◊™</th>
                                                        </tr>
                                                      </thead>
                                                      <tbody>
                                                        <% Object.entries(orgStats).forEach(([org, count]) => { %>
                                                          <tr>
                                                            <td><%= org %></td>
                                                            <td><%= count %></td>
                                                          </tr>
                                                        <% }) %>
                                                      </tbody>
                                                      <tfoot>
                                                        <tr>
                                                          <td><strong>◊°◊î\"◊õ</strong></td>
                                                          <td><strong><%= Object.values(orgStats).reduce((a,b)=>a+b,0) %></strong></td>
                                                        </tr>
                                                      </tfoot>
                                                    </table>
                                                  </div>

                                                                                          <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 40px; margin-bottom: 30px;">



                                                                                            <!-- ◊õ◊®◊ò◊ô◊° ◊°◊ô◊®◊ï◊ë◊ô◊ù -->
                                                                                            <% if (refusedCoordinations && refusedCoordinations.length > 0) { %>
                                                                                          <div style="margin: 20px 0; background: #fff; padding: 14px; border-radius: 8px; border: 1px solid #ccc;">
                                                                                                <h4 style="margin: 0 0 8px 0; color: #b00020; text-align: right;">üö´ ◊û◊©◊ê◊ô◊ï◊™ ◊û◊°◊ï◊®◊ë◊ï◊™</h4>
                                                                                                <ol style="margin: 0; padding-right: 20px; color: #000; text-align: right; direction: rtl;">
                                                                                                  <% refusedCoordinations.forEach(item => { %>
                                                                                                    <li style="margin-bottom: 6px;">
                                                                                                      ◊™◊ô◊ê◊ï◊ù <strong><%= item.coordinationNumber %></strong> - ◊ê◊®◊í◊ï◊ü <strong><%= item.donorOrg %></strong> - ◊°◊ô◊ë◊î: <%= item.reason %>
                                                                                                    </li>
                                                                                                  <% }); %>
                                                                                                </ol>
                                                                                              </div>
                                                                                            <% } %>
                                                                                          <!-- üîç ◊õ◊§◊™◊ï◊® ◊ê◊ß◊°◊ú ◊û◊ô◊ï◊©◊® ◊ú◊û◊®◊õ◊ñ + ◊©◊ï◊®◊™ ◊ó◊ô◊§◊ï◊© ◊ë◊®◊ï◊ó◊ë ◊û◊ì◊ï◊ô◊ß ◊©◊ú ◊î◊ò◊ë◊ú◊î -->
                                                                                          <div style="max-width: 1400px; margin: 0 auto 20px auto; padding: 0 30px;">
                                                                                            <!-- ◊õ◊§◊™◊ï◊® ◊ê◊ß◊°◊ú ◊ë◊û◊®◊õ◊ñ -->
                                                                                            <div style="text-align: center; margin-bottom: 15px;">
                                                                                              <a href="/export-csv" class="excel-button" download>
                                                                                                <img src="https://cdn-icons-png.flaticon.com/512/732/732220.png" alt="Excel Icon">
                                                                                                ◊ô◊ô◊¶◊ï◊ê ◊ú◊ê◊ß◊°◊ú
                                                                                              </a>
                                                                                            </div>


                                                                                          <script>
                                                                                            function goToDate(event) {
                                                                                              event.preventDefault();
                                                                                              const date = document.getElementById('datePicker').value;
                                                                                              if (!date) return alert('◊ô◊© ◊ú◊ë◊ó◊ï◊® ◊™◊ê◊®◊ô◊ö');
                                                                                              window.location.href = `/statistics/${date}`;
                                                                                            }
                                                                                          </script>


                                                                                          <%
                                                                                            function isRejected(driver) {
                                                                                              return refusedCoordinations.some(coord =>
                                                                                                coord.coordinationNumber === driver.coordinationNumber &&
                                                                                                coord.donorOrg === driver.donorOrg
                                                                                              );
                                                                                            }
                                                                                          %>

                                                                                              <table class="drivers-table" id="statsTable">
                                                                                               <thead>
                                                                                            <tr>
                                                                                          <th onclick="sortTable(0, 'text')">◊©◊ù ◊†◊î◊í ‚¨ç</th>
                                                                                          <th onclick="sortTable(1, 'number')">◊™◊¢◊ï◊ì◊™ ◊ñ◊î◊ï◊™ ‚¨ç</th>
                                                                                          <th onclick="sortTable(2, 'text')">◊ò◊ú◊§◊ï◊ü ‚¨ç</th>
                                                                                          <th onclick="sortTable(3, 'number')">◊û◊°◊§◊® ◊™◊ô◊ê◊ï◊ù ‚¨ç</th>
                                                                                          <th onclick="sortTable(4, 'text')">◊û◊°◊§◊® ◊û◊©◊ê◊ô◊™ ‚¨ç</th>
                                                                                          <th onclick="sortTable(5, 'text')">◊†◊™◊ô◊ë ‚¨ç</th>
                                                                                          <th onclick="sortTable(6, 'text')">◊°◊ï◊í ◊°◊ó◊ï◊®◊î ‚¨ç</th>
                                                                                          <th onclick="sortTable(7, 'number')">◊û◊°' ◊û◊©◊ò◊ó◊ô◊ù ‚¨ç</th>
                                                                                          <th onclick="sortTable(8, 'text')">◊ê◊®◊í◊ï◊ü ◊™◊ï◊®◊ù ‚¨ç</th>
                                                                                          <th onclick="sortTable(9, 'text')">◊©◊¢◊î ‚¨ç</th>
                                                                                          <th onclick="sortTable(10, 'text')">◊î◊ï◊ñ◊ü ◊ë◊ô◊ï◊ë◊ú ‚¨ç</th>
                                                                                          <th onclick="sortTable(11, 'text')">◊î◊ï◊ì◊§◊° Gate Pass ‚¨ç</th>
                                                                                          <th id="dateColumnHeader" style="display: none;">◊™◊ê◊®◊ô◊ö</th>

                                                                                            </tr>
                                                                                          </thead>
                                                                                                <tbody>
                                                                                                  <% passedDrivers.forEach((driver, index) => { %>
                                                                                          <% if (isRejected(driver)) { %>
                                                                                            <tr style="background-color: #f8cccc;">
                                                                                          <% } else { %>
                                                                                            <tr>
                                                                                          <% } %>
                                                                                          <td style="text-align: right;">
                                                                                           <form action="/reject-driver-form" method="GET" style="margin: 0;">
                                                                                          <input type="hidden" name="idNumber" value="<%= driver.idNumber %>">
                                                                                            <input type="hidden" name="coordinationNumber" value="<%= driver.coordinationNumber %>">
                                                                                            <button type="submit"
                                                                                              style="background: none; border: none; color: #d32f2f !important; font-size: 22px; font-weight: bold; cursor: pointer;"
                                                                                              title="◊°◊û◊ü ◊°◊ô◊®◊ï◊ë">‚ûñ
                                                                                            </button>
                                                                                          </form>
                                                                                            <span style="margin-right: 10px;"><%= driver.name %></span>
                                                                                          </td>


                                                                                                      <td><%= driver.idNumber %></td>
                                                                                          <td style="white-space: nowrap; direction: ltr;"><%= driver.phone || driver.phoneNumber || '‚Äî' %></td>
                                                                                          <td><%= driver.coordinationNumber %></td>
                                                                                                        <td><%= driver.truckNumber || '‚Äî' %></td>
                                                                                                       <td><%= driver.route || '-' %></td>
                                                                                                      <td><%= driver.goodsType %></td>
                                                                                                      <td><%= driver.palletCount || '‚Äî' %></td>
                                                                                                      <td><%= driver.donorOrg || '' %></td>
                                                                                                      <td><%= driver.passedAt %></td>
                                                                                                    <td>
                                                                                           <input
                                                                                            type="checkbox"
                                                                                            data-id="<%= driver.idNumber %>"
                                                                                            data-coord="<%= driver.coordinationNumber %>"
                                                                                            <%= yuvalData && yuvalData[driver.idNumber + '-' + driver.coordinationNumber] ? 'checked' : '' %>
                                                                                            onchange="updateYuvalStatus(this)"
                                                                                          />

                                                                                          </td>

                                                                                              <td style="font-weight: bold;
                                                                                            <% if (driver.gatePassPrinted) { %>
                                                                                              color: #1d6f42;
                                                                                            <% } else { %>
                                                                                              color: crimson;
                                                                                            <% } %>
                                                                                          ">
                                                                                            <% if (driver.gatePassPrinted) { %>
                                                                                              ‚úîÔ∏è
                                                                                            <% } else { %>
                                                                                              ‚ùå
                                                                                            <% } %>
                                                                                          </td>
                                                                                                    </tr>
                                                                                                  <% }); %>

                                                                                                </tbody>
                                                                                              </table>

                                                                                              <div style="text-align: center;">
                                                                                                <a href="/" class="statistics-button">‚¨ÖÔ∏è ◊ó◊ñ◊®◊î ◊ú◊®◊©◊ô◊û◊™ ◊î◊†◊î◊í◊ô◊ù</a>
                                                                                              </div>
                                                                                            </div>
                                                                                          <script>
                                                                                            // ◊§◊ï◊†◊ß◊¶◊ô◊î ◊ú◊û◊ô◊ï◊ü ◊ò◊ë◊ú◊î
                                                                                            function sortTable(n, type = 'text') {
                                                                                              const table = document.getElementById("statsTable");
                                                                                              let rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                                                                                              switching = true;
                                                                                              dir = "asc";

                                                                                              while (switching) {
                                                                                                switching = false;
                                                                                                rows = table.rows;
                                                                                                for (i = 1; i < (rows.length - 1); i++) {
                                                                                                  shouldSwitch = false;
                                                                                                  x = rows[i].getElementsByTagName("TD")[n];
                                                                                                  y = rows[i + 1].getElementsByTagName("TD")[n];

                                                                                                  let xVal = x.innerText.toLowerCase();
                                                                                                  let yVal = y.innerText.toLowerCase();

                                                                                                  if (type === 'number') {
                                                                                                    xVal = parseFloat(xVal.replace(/[^\d.-]/g, '')) || 0;
                                                                                                    yVal = parseFloat(yVal.replace(/[^\d.-]/g, '')) || 0;
                                                                                                  }

                                                                                                  if ((dir === "asc" && xVal > yVal) || (dir === "desc" && xVal < yVal)) {
                                                                                                    shouldSwitch = true;
                                                                                                    break;
                                                                                                  }
                                                                                                }
                                                                                                if (shouldSwitch) {
                                                                                                  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                                                                                                  switching = true;
                                                                                                  switchcount++;
                                                                                                } else if (switchcount === 0 && dir === "asc") {
                                                                                                  dir = "desc";
                                                                                                  switching = true;
                                                                                                }
                                                                                              }
                                                                                            }
                                                                                          </script>
                                                                                            <script>
                                                                                            document.addEventListener('DOMContentLoaded', function () {
                                                                                              let searchInHistory = false;

                                                                                              const toggleBtn = document.getElementById('toggleHistory');
                                                                                              const searchForm = document.getElementById('searchForm');
                                                                                              const filterInput = document.getElementById('filterInput');
                                                                                              const dateColumn = document.getElementById('dateColumnHeader');

                                                                                              // ‚¨ÖÔ∏è ◊ú◊ó◊ô◊¶◊î ◊¢◊ú ◊ê◊ô◊ô◊ß◊ï◊ü ◊ú◊ï◊ó ◊©◊†◊î
                                                                                              toggleBtn.addEventListener('click', () => {
                                                                                                searchInHistory = !searchInHistory;

                                                                                                // ◊¢◊ô◊¶◊ï◊ë ◊î◊ê◊ô◊ô◊ß◊ï◊ü
                                                                                                if (searchInHistory) {
                                                                                                  toggleBtn.style.backgroundColor = '#004080';
                                                                                                  toggleBtn.style.color = 'white';
                                                                                                  toggleBtn.title = "◊ó◊ô◊§◊ï◊© ◊î◊ô◊°◊ò◊ï◊®◊ô ◊§◊¢◊ô◊ú";
                                                                                                  dateColumn.style.display = 'table-cell';
                                                                                                } else {
                                                                                                  toggleBtn.style.backgroundColor = 'white';
                                                                                                  toggleBtn.style.color = '#004080';
                                                                                                  toggleBtn.title = "◊ó◊ô◊§◊ï◊© ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊ï◊™ ◊©◊ú ◊î◊ô◊ï◊ù ◊ë◊ú◊ë◊ì";
                                                                                                  dateColumn.style.display = 'none';
                                                                                                }

                                                                                                toggleBtn.innerHTML = `<i class="fa-solid fa-calendar-days"></i>`;
                                                                                              });

                                                                                              // ‚¨ÖÔ∏è ◊©◊ú◊ô◊ó◊™ ◊ò◊ï◊§◊° ◊î◊ó◊ô◊§◊ï◊©
                                                                                              searchForm.addEventListener('submit', function (e) {
                                                                                                e.preventDefault();
                                                                                                const query = filterInput.value.trim();
                                                                                                if (!query) {
                                                                                                  alert('◊ô◊© ◊ú◊î◊ñ◊ô◊ü ◊ò◊ß◊°◊ò ◊ú◊ó◊ô◊§◊ï◊©');
                                                                                                  return;
                                                                                                }

                                                                                                if (searchInHistory) {
                                                                                                  fetch('/search-statistics?query=' + encodeURIComponent(query))
                                                                                                    .then(res => res.json())
                                                                                                    .then(data => {
                                                                                                      const tbody = document.querySelector("#statsTable tbody");
                                                                                                      tbody.innerHTML = '';
                                                                                                      dateColumn.style.display = 'table-cell';

                                                                                                      if (!Array.isArray(data) || data.length === 0) {
                                                                                                        alert('◊ú◊ê ◊†◊û◊¶◊ê◊ï ◊™◊ï◊¶◊ê◊ï◊™ ◊ë◊î◊ô◊°◊ò◊ï◊®◊ô◊î');
                                                                                                        return;
                                                                                                      }

                                                                                                      data.forEach(driver => {
                                                                                                        const row = document.createElement('tr');
                                                                                                        row.innerHTML = `
                                                                                                          <td>${driver.name || '‚Äî'}</td>
                                                                                                          <td>${driver.idNumber || '‚Äî'}</td>
                                                                                                          <td style="white-space: nowrap; direction: ltr;">${driver.phone || driver.phoneNumber || '‚Äî'}</td>
                                                                                                          <td>${driver.coordinationNumber || '‚Äî'}</td>
                                                                                                          <td>${driver.truckNumber || '‚Äî'}</td>
                                                                                                          <td>${driver.route || '‚Äî'}</td>
                                                                                                          <td>${driver.goodsType || '‚Äî'}</td>
                                                                                                          <td>${driver.palletCount || '‚Äî'}</td>
                                                                                                          <td>${driver.donorOrg || '‚Äî'}</td>
                                                                                                          <td>${driver.passedAt || '‚Äî'}</td>
                                                                                                          <td>‚Äî</td>
                                                                                                          <td>${driver.gatePassPrinted ? '‚úîÔ∏è' : '‚ùå'}</td>
                                                                                                          <td>${driver.date || '‚Äî'}</td>
                                                                                                        `;
                                                                                                        tbody.appendChild(row);
                                                                                                      });

                                                                                                      alert(`◊†◊û◊¶◊ê◊ï ${data.length} ◊™◊ï◊¶◊ê◊ï◊™ ◊™◊ï◊ê◊û◊ï◊™ ◊ë◊™◊ô◊ê◊ï◊û◊ô ◊¢◊ë◊®`);
                                                                                                    })
                                                                                                    .catch(err => {
                                                                                                      console.error(err);
                                                                                                      alert('◊©◊í◊ô◊ê◊î ◊ë◊¢◊™ ◊î◊ó◊ô◊§◊ï◊©');
                                                                                                    });
                                                                                                } else {
                                                                                                  // üîç ◊ó◊ô◊§◊ï◊© ◊û◊™◊ï◊ö ◊°◊ò◊ò◊ô◊°◊ò◊ô◊ß◊î ◊ó◊ô◊î (drivers.json)
                                                                                                  window.location.href = `/statistics?q=${encodeURIComponent(query)}`;
                                                                                                }
                                                                                              });
                                                                                            });
                                                                                          </script>
                                                                                          <script>
                                                                                          function updateYuvalStatus(checkbox) {
                                                                                            const id = checkbox.dataset.id;
                                                                                            const coordination = checkbox.dataset.coord;
                                                                                            const key = `${id}-${coordination}`;
                                                                                            const value = checkbox.checked;

                                                                                            fetch(`/update-yuval/${key}`, {
                                                                                              method: 'POST',
                                                                                              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                                                                                              body: new URLSearchParams({ yuval: value ? 'on' : '' })
                                                                                            }).then(res => {
                                                                                              if (!res.ok) {
                                                                                                alert('◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊î');
                                                                                                checkbox.checked = !value;
                                                                                              }
                                                                                            }).catch(() => {
                                                                                              alert('◊©◊í◊ô◊ê◊î ◊ë◊ó◊ô◊ë◊ï◊® ◊ú◊©◊®◊™');
                                                                                              checkbox.checked = !value;
                                                                                            });
                                                                                          }
                                                                                          </script>


                                                                                          </body>
                                                                                          </html>